# SRC/EVENTS - Event System Module

**Scope:** src/events only

## OVERVIEW

GPUI event type system: base events, mouse, keyboard, focus, scroll, plus factory/router. All types flow through
event-router to registered handlers.

## STRUCTURE

```
src/events/
├── index.ts           # Barrel file (re-exports all)
├── base.ts            # GPUIBaseEvent, EventPhase, ModifierKeys
├── mouse.ts           # GPUIMouseEvent, MouseButtons, bubbling rules
├── keyboard.ts        # GPUIKeyboardEvent, KeyCodes
├── focus.ts           # GPUIFocusEvent, bubbling rules
├── scroll.ts          # GPUIScrollEvent, GPUIWheelEvent
├── types.ts           # GPUIEvent, GPUIEventMap, handler types, mappings
├── factory.ts         # createEvent() factory function
└── router.ts          # EventRouter class, handler registration
```

## WHERE TO LOOK

| Task            | File        | Notes                                                 |
| --------------- | ----------- | ----------------------------------------------------- |
| Event types     | types.ts    | GPUIEvent, GPUIEventHandler, GPUIEventType maps       |
| Event factory   | factory.ts  | createEvent() - deserializes Rust JSON events         |
| Event router    | router.ts   | EventRouter: registerEventHandler, bindEventToElement |
| Mouse events    | mouse.ts    | MouseButtons, isMouseEvent, bubbling rules            |
| Focus events    | focus.ts    | GPUIFocusEvent, shouldFocusEventBubble                |
| Scroll events   | scroll.ts   | GPUIScrollEvent, GPUIWheelEvent                       |
| Keyboard events | keyboard.ts | GPUIKeyboardEvent, KeyCodes                           |
| Base types      | base.ts     | GPUIBaseEvent, ModifierKeys, EventPhase               |

## CONVENTIONS

- **Event registration:** All handlers registered via EventRouter, never directly
- **Event IDs:** Handlers stored as incrementing IDs passed to Rust
- **Event mapping:** EVENT_PROP_TO_TYPE / EVENT_TYPE_TO_PROP for prop↔type conversion
- **Bubbling:** Different rules per domain (mouse, focus use different bubbling)
- **Generated types:** types.ts may include imports from generated.ts

## ANTI-PATTERNS (THIS PROJECT)

- Don't edit events/generated.ts - auto-generated by codegen binary
- Don't bypass EventRouter for handler registration
- Don't assume all events bubble - check type-specific rules
- Don't forget to bindEventToElement after registering handler

## KEY PATTERNS

- **Two-level Map:** Map<elementId, Map<eventType, handlerId>> for routing
- **Event deserialization:** createEvent() parses JSON from Rust callback
- **Handler options:** HandlerOptions for debounce, capture phase
- **Domain separation:** Each event type (mouse, keyboard, focus, scroll) has dedicated module
- **Event prop mapping:** SUPPORTED_EVENT_PROPS array validates prop names
